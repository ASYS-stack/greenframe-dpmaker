<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>DP Maker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  background:#111;
  color:#fff;
  font-family:Arial, sans-serif;
  text-align:center;
}
canvas{
  background:#000;
  max-width:100%;
}
.controls button{
  margin:4px;
  padding:10px 14px;
  font-size:14px;
}
</style>
</head>
<body>

<h3>Vote For Kapil Krishna Mondal – DP Maker</h3>

<input type="file" id="upload" accept="image/*"><br><br>

<canvas id="canvas" width="1080" height="1080"></canvas>

<div class="controls">
  <button onclick="move(0,-20)">⬆</button>
  <button onclick="move(-20,0)">⬅</button>
  <button onclick="move(20,0)">➡</button>
  <button onclick="move(0,20)">⬇</button><br>
  <button onclick="zoom(1.1)">Zoom +</button>
  <button onclick="zoom(0.9)">Zoom −</button><br>
  <button onclick="downloadDP()">Download</button>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let userImg = new Image();
let frameImg = new Image();

let scale = 1;
let posX = 0;
let posY = 0;

frameImg.src = "frame.png";

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(userImg.src){
    const w = userImg.width * scale;
    const h = userImg.height * scale;
    ctx.drawImage(
      userImg,
      canvas.width/2 - w/2 + posX,
      canvas.height/2 - h/2 + posY,
      w,h
    );
  }

  // mask circle
  ctx.globalCompositeOperation="destination-in";
  ctx.beginPath();
  ctx.arc(canvas.width/2, canvas.height/2, 360, 0, Math.PI*2);
  ctx.fill();
  ctx.globalCompositeOperation="destination-over";

  if(frameImg.complete){
    ctx.drawImage(frameImg,0,0,canvas.width,canvas.height);
  }
}

upload.onchange = e =>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = ()=>{
    userImg = new Image();
    userImg.onload = ()=>{
      scale = 1;
      posX = 0;
      posY = 0;
      draw();
    };
    userImg.src = reader.result;
  };
  reader.readAsDataURL(file);
};

function zoom(f){
  scale *= f;
  draw();
}

function move(x,y){
  posX += x;
  posY += y;
  draw();
}

function downloadDP(){
  canvas.toBlob(blob=>{
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "dp.png";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  });
}

frameImg.onload = draw;
</script>

</body>
</html>

